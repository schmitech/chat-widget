<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Widget Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2C3E50;
            margin-bottom: 10px;
            border-bottom: 2px solid #f97316;
            padding-bottom: 10px;
        }
        h2 {
            color: #2C3E50;
            margin-top: 25px;
            font-size: 20px;
        }
        .subtitle {
            color: #666;
            margin-top: 0;
            margin-bottom: 25px;
        }
        .demo-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #f97316;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            background: #2C3E50;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        button:hover {
            background: #1a202c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button:active {
            background: #2C3E50;
            transform: translateY(0);
        }
        button.secondary {
            background: #f97316;
        }
        button.secondary:hover {
            background: #ea580c;
        }
        button.tertiary {
            background: #64748b;
        }
        button.tertiary:hover {
            background: #475569;
        }
        button:disabled {
            background: #e5e7eb !important;
            color: #9ca3af !important;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: monospace;
            margin: 15px 0;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .feature-card h3 {
            margin-top: 0;
            color: #2C3E50;
        }
        .custom-container {
            border: 2px dashed #cbd5e1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
            min-height: 100px;
        }
        .api-url-form {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .api-url-form input {
            flex: 1;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: #64748b;
            font-size: 14px;
        }
        .color-customizer {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #3b82f6;
        }
        .color-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
            align-items: center;
        }
        .color-field {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .color-field label {
            font-size: 14px;
            width: 120px;
        }
        .theme-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .theme-card {
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            position: relative;
        }
        .theme-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .theme-card.active {
            outline: 3px solid #3b82f6;
        }
        .theme-card-header {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .theme-card-body {
            height: 60px;
            padding: 10px;
        }
        .theme-card-name {
            text-align: center;
            font-weight: 500;
            margin-bottom: 5px;
        }
        .theme-accent {
            height: 5px;
        }
        .apply-custom-btn {
            background: #f1f5f9;
            color: #1e293b;
            border: 1px solid #cbd5e1;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.2s ease;
        }
        .apply-custom-btn:hover {
            background: #e2e8f0;
            color: #0f172a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .icon-btn {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            color: #1e293b;
            padding: 8px 12px;
            transition: all 0.2s ease;
        }
        .icon-btn:hover {
            background: #f1f5f9;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            color: #0f172a;
        }
        #chatbot-widget, #chatbot-widget * {
            font-family: 'Mona Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chatbot Widget Demo</h1>
        <p class="subtitle">Test and configure the chatbot widget in real-time</p>

        <div class="api-url-form">
            <input type="text" id="api-url" placeholder="API URL (e.g., http://localhost:3000)" value="http://localhost:3000">
            <input type="text" id="api-key" placeholder="API Key" value="demo-api-key" required>
            <button onclick="updateApiUrl()">Update API Settings</button>
        </div>

        <h2>Built-in Themes</h2>
        <div class="theme-cards">
            <div class="theme-card active" onclick="updateTheme('modern')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #4f46e5, #7c3aed);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Modern</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('minimal')">
                <div class="theme-card-header" style="background: #fafafa; color: #1a1a1a; border-bottom: 1px solid #e5e7eb;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #374151, #6b7280);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Minimal</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('corporate')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #3b82f6, #1d4ed8);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Corporate</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('dark')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #06b6d4, #0891b2);"></div>
                <div class="theme-card-body" style="background: #1f2937; color: #f3f4f6;">
                    <div class="theme-card-name">Dark</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('emerald')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #064e3b 0%, #065f46 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #10b981, #059669);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Emerald</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('sunset')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #f59e0b, #ef4444);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Sunset</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('lavender')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #8b5cf6, #a855f7);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Lavender</div>
                </div>
            </div>

            <div class="theme-card" onclick="updateTheme('monochrome')">
                <div class="theme-card-header" style="background: linear-gradient(135deg, #1f2937 0%, #374151 100%); color: white;">
                    Demo Chat
                </div>
                <div class="theme-accent" style="background: linear-gradient(90deg, #6b7280, #4b5563);"></div>
                <div class="theme-card-body">
                    <div class="theme-card-name">Monochrome</div>
                </div>
            </div>
        </div>

        <h2>Custom Color Picker</h2>
        <div class="color-customizer">
            <p>Fine-tune the widget's colors to match your brand perfectly:</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Main Colors Section -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #fafafa;">
                    <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #2C3E50; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">Main Colors</h3>
                    
                    <div class="color-field" style="margin-bottom: 12px;">
                        <label for="primary-color">Primary Color:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="primary-color" value="#2C3E50">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #2C3E50; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                    <div class="color-field" style="margin-bottom: 12px;">
                        <label for="secondary-color">Accent Color:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="secondary-color" value="#f97316">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #f97316; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                    <div class="color-field" style="margin-bottom: 12px;">
                        <label for="background-color">Background:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="background-color" value="#ffffff">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #ffffff; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                    <div class="color-field">
                        <label for="text-primary-color">Primary Text:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="text-primary-color" value="#1a1a1a">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #1a1a1a; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Message Bubbles Section -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #fafafa;">
                    <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #2C3E50; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">Message Bubbles</h3>
                    
                    <div class="color-field" style="margin-bottom: 12px;">
                        <label for="user-bubble-color">User Bubble:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="user-bubble-color" value="#2C3E50">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #2C3E50; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                    <div class="color-field">
                        <label for="assistant-bubble-color">Assistant Bubble:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="assistant-bubble-color" value="#ffffff">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #ffffff; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Suggested Questions Section -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #fafafa;">
                    <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #2C3E50; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">Suggested Questions</h3>
                    
                    <div class="color-field">
                        <label for="suggested-text-color">Text Color:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="suggested-text-color" value="#2C3E50">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #2C3E50; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Icon Color Section -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #fafafa;">
                    <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #2C3E50; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">Icon</h3>
                    
                    <div class="color-field">
                        <label for="icon-color">Icon Color:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="icon-color" value="#f97316">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #f97316; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                </div>

                <!-- Chat Button Section -->
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #fafafa;">
                    <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #2C3E50; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">Chat Button</h3>
                    
                    <div class="color-field" style="margin-bottom: 12px;">
                        <label for="chat-button-bg-color">Background:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="chat-button-bg-color" value="#ffffff">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #ffffff; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                    <div class="color-field">
                        <label for="chat-button-hover-color">Hover Background:</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="chat-button-hover-color" value="#f8fafc">
                            <div style="margin-left: 10px; height: 24px; width: 100px; background: #f8fafc; border-radius: 4px; border: 1px solid #e5e7eb;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: center;">
                <button onclick="applyCustomColors()" class="apply-custom-btn" style="padding: 12px 24px; font-size: 16px; background: #f1f5f9; color: #1e293b; border: 1px solid #cbd5e1; font-weight: 600;">Apply Custom Colors</button>
                <button onclick="resetThemeColors()" class="apply-custom-btn" style="padding: 12px 24px; font-size: 16px; background: #f1f5f9; color: #1e293b; border: 1px solid #cbd5e1; font-weight: 600; margin-left: 10px;">Reset to Default</button>
            </div>
        </div>

        <h2>Custom Limits</h2>
        <div class="color-customizer">
            <div class="color-row">
                <div class="color-field">
                    <label for="max-suggested-question-length">Max Question Length:</label>
                    <input type="number" id="max-suggested-question-length" min="10" max="200" value="50" style="width: 80px;">
                </div>
                <div class="color-field">
                    <label for="max-suggested-question-query-length">Max Query Length:</label>
                    <input type="number" id="max-suggested-question-query-length" min="50" max="1000" value="200" style="width: 80px;">
                </div>
            </div>
            <button onclick="applyCustomLimits()" class="apply-custom-btn" style="padding: 8px 18px; font-size: 15px; margin-top: 10px;">Apply Custom Limits</button>
        </div>

        <h2>Icon Selection</h2>
        <div class="demo-controls">
            <p>Choose an icon for your chatbot widget:</p>
            <div class="button-group">
                <button onclick="updateIcon('heart')" class="icon-btn">❤️ Heart</button>
                <button onclick="updateIcon('message-square')" class="icon-btn">💬 Message Square</button>
                <button onclick="updateIcon('message-circle')" class="icon-btn">🗨️ Message Circle</button>
                <button onclick="updateIcon('help-circle')" class="icon-btn">❓ Help Circle</button>
                <button onclick="updateIcon('info')" class="icon-btn">ℹ️ Info</button>
                <button onclick="updateIcon('bot')" class="icon-btn">🤖 Bot</button>
                <button onclick="updateIcon('sparkles')" class="icon-btn">✨ Sparkles</button>
            </div>
        </div>

        <h2>Widget Controls</h2>
        <div class="demo-controls">
            <div class="button-group">
                <button onclick="updateContent('default')">Default Content</button>
                <button onclick="updateContent('custom')" class="secondary">Custom Content</button>
            </div>
            <div class="button-group">
                <button onclick="toggleChat()">Toggle Chat</button>
                <button onclick="resetWidget()" class="tertiary">Reset Widget</button>
            </div>
        </div>

        <!-- Add the main chatbot container -->
        <div id="chatbot-widget"></div>

        <h2>Custom Container Demo</h2>
        <p>You can render the widget in a custom container instead of the bottom-right corner:</p>
        <button onclick="initInCustomContainer()">Initialize in Custom Container</button>
        <div id="custom-container" class="custom-container">
            <p>Widget will appear here when you click the button above</p>
        </div>

        <h2>Implementation Code</h2>
        <p>Copy and paste this code into your website to add the chatbot widget:</p>
        <div class="code-block">
            <pre><code id="implementation-code" class="language-html">&lt;!-- Include dependencies -->
&lt;script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin>&lt;/script>
&lt;script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin>&lt;/script>
&lt;script src="/chatbot-widget.umd.js">&lt;/script>
&lt;link rel="stylesheet" href="/style.css">

&lt;script>
  window.addEventListener('load', function() {
    window.initChatbotWidget({
      apiUrl: 'http://localhost:3000',
      widgetConfig: {
        header: { title: "Demo Chat" },
        welcome: { 
          title: "Welcome to the Demo!",
          description: "This is a test of the chatbot widget. Try asking about the features or customization options."
        },
        suggestedQuestions: [
          {
            text: "I need some help",
            query: "How can you help me?"
          },
          {
            text: "Change theme",
            query: "How do I customize the appearance?"
          },
          {
            text: "API integration",
            query: "How do I connect to my own API?"
          },
          {
            text: "Widget features",
            query: "What features does this widget support?"
          },
          {
            text: "Customization options",
            query: "What can I customize in this widget?"
          }
        ],
        theme: {
          primary: '#2C3E50',
          secondary: '#f97316',
          background: '#ffffff',
          text: {
            primary: '#1a1a1a',
            secondary: '#666666',
            inverse: '#ffffff'
          },
          input: {
            background: '#f9fafb',
            border: '#e5e7eb'
          },
          message: {
            user: '#2C3E50',
            assistant: '#ffffff',
            userText: '#ffffff'
          },
          suggestedQuestions: {
            background: '#fff7ed',
            hoverBackground: '#ffedd5',
            text: '#2C3E50'
          },
          chatButton: {
            background: '#ffffff',
            hoverBackground: '#f8fafc'
          },
          iconColor: '#f97316'
        },
        icon: "message-square"
      }
    });
  });
&lt;/script></code></pre>
        </div>
        <button onclick="copyImplementationCode()" class="secondary">Copy Code</button>

        <h2>Widget Features</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h3>Customizable Theme</h3>
                <p>Change colors and styling to match your brand</p>
            </div>
            <div class="feature-card">
                <h3>Dynamic Updates</h3>
                <p>Update content and appearance without refreshing</p>
            </div>
            <div class="feature-card">
                <h3>Markdown Support</h3>
                <p>Format responses with rich text and links</p>
            </div>
            <div class="feature-card">
                <h3>Responsive Design</h3>
                <p>Works on desktop and mobile devices</p>
            </div>
        </div>

        <footer>
            <p>Chatbot Widget Demo | Start the API server with <code>npm run start</code> in the api directory</p>
        </footer>
    </div>

    <!-- Required dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="./dist/chatbot-widget.umd.js"></script>
    <link rel="stylesheet" href="./dist/chatbot-widget.css">

    <!-- Prism.js JS for syntax highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>

    <script>
        // Check if ChatbotWidget is available
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkWidgetLoaded, 100);
        });

        function checkWidgetLoaded() {
            if (typeof window.ChatbotWidget !== 'undefined' && window.initChatbotWidget) {
                // Also ensure React is available
                if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined') {
                    console.error('React or ReactDOM not loaded!');
                    console.log('Waiting for React to load...');
                    setTimeout(checkWidgetLoaded, 100);
                    return;
                }
                
                console.log('ChatbotWidget loaded successfully! Starting initialization...');
                initializeDemo();
            } else {
                console.log('Waiting for ChatbotWidget to load...');
                setTimeout(checkWidgetLoaded, 100);
            }
        }

        function initializeDemo() {
            // All initialization code goes here
            console.log('Initializing demo...');
            
            // Ensure containers exist
            if (!document.getElementById('chatbot-widget')) {
                const container = document.createElement('div');
                container.id = 'chatbot-widget';
                document.body.appendChild(container);
            }
            
            if (!document.getElementById('custom-container')) {
                const customContainer = document.createElement('div');
                customContainer.id = 'custom-container';
                customContainer.className = 'custom-container';
                customContainer.innerHTML = '<p>Widget will appear here when you click the button above</p>';
                document.body.appendChild(customContainer);
            }
            
            // Initialize the widget
            initWidget();
        }

        let widgetInitialized = false;
        let customWidgetInitialized = false;
        
        // Theme presets
        const themes = {
            modern: {
                primary: '#4f46e5',
                secondary: '#7c3aed',
                background: '#ffffff',
                text: {
                    primary: '#111827',
                    secondary: '#6b7280',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#f9fafb',
                    border: '#e5e7eb'
                },
                message: {
                    user: '#4f46e5',
                    assistant: '#f8fafc',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#4338ca'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#f8fafc'
                },
                iconColor: '#7c3aed'
            },
            minimal: {
                primary: '#374151',
                secondary: '#6b7280',
                background: '#ffffff',
                text: {
                    primary: '#111827',
                    secondary: '#6b7280',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#f9fafb',
                    border: '#d1d5db'
                },
                message: {
                    user: '#374151',
                    assistant: '#f9fafb',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#374151'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#f9fafb'
                },
                iconColor: '#6b7280'
            },
            corporate: {
                primary: '#1e40af',
                secondary: '#3b82f6',
                background: '#ffffff',
                text: {
                    primary: '#1e293b',
                    secondary: '#64748b',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#f8fafc',
                    border: '#e2e8f0'
                },
                message: {
                    user: '#1e40af',
                    assistant: '#f1f5f9',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#1d4ed8'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#f8fafc'
                },
                iconColor: '#3b82f6'
            },
            dark: {
                primary: '#0f172a',
                secondary: '#06b6d4',
                background: '#1e293b',
                text: {
                    primary: '#f1f5f9',
                    secondary: '#cbd5e1',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#334155',
                    border: '#475569'
                },
                message: {
                    user: '#06b6d4',
                    assistant: '#0f172a',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#67e8f9'
                },
                chatButton: {
                    background: '#334155',
                    hoverBackground: '#475569'
                },
                iconColor: '#06b6d4'
            },
            emerald: {
                primary: '#065f46',
                secondary: '#10b981',
                background: '#ffffff',
                text: {
                    primary: '#1f2937',
                    secondary: '#6b7280',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#f0fdf4',
                    border: '#d1fae5'
                },
                message: {
                    user: '#065f46',
                    assistant: '#ecfdf5',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#047857'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#f0fdf4'
                },
                iconColor: '#10b981'
            },
            sunset: {
                primary: '#dc2626',
                secondary: '#f59e0b',
                background: '#ffffff',
                text: {
                    primary: '#1f2937',
                    secondary: '#6b7280',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#fffbeb',
                    border: '#fed7aa'
                },
                message: {
                    user: '#dc2626',
                    assistant: '#fff7ed',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#c2410c'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#fffbeb'
                },
                iconColor: '#f59e0b'
            },
            lavender: {
                primary: '#7c3aed',
                secondary: '#a855f7',
                background: '#ffffff',
                text: {
                    primary: '#1f2937',
                    secondary: '#6b7280',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#faf5ff',
                    border: '#e9d5ff'
                },
                message: {
                    user: '#7c3aed',
                    assistant: '#f5f3ff',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#6d28d9'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#faf5ff'
                },
                iconColor: '#a855f7'
            },
            monochrome: {
                primary: '#1f2937',
                secondary: '#6b7280',
                background: '#ffffff',
                text: {
                    primary: '#111827',
                    secondary: '#6b7280',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#f9fafb',
                    border: '#d1d5db'
                },
                message: {
                    user: '#1f2937',
                    assistant: '#f3f4f6',
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    text: '#374151'
                },
                chatButton: {
                    background: '#ffffff',
                    hoverBackground: '#f9fafb'
                },
                iconColor: '#6b7280'
            }
        };
        
        // Store initial configurations for reset
        const defaultConfig = {
            header: {
                title: "Demo Chat"
            },
            welcome: {
                title: "Welcome to the Demo!",
                description: "This is a test of the chatbot widget. Try asking about the features or customization options."
            },
            suggestedQuestions: [
                {
                    text: "I need some help.",
                    query: "How can you help me?"
                },
                {
                    text: "What happened with the dinosaurs?",
                    query: "I would like to know why the dinosaurs dissapeared."
                },
                {
                    text: "API integration",
                    query: "How do I connect to my own API?"
                },
                {
                    text: "Widget features",
                    query: "What features does this widget support?"
                },
                {
                    text: "Customization options",
                    query: "What can I customize in this widget?"
                }
            ],
            theme: themes.modern,
            icon: "message-square"
        };

        // Content presets
        const contents = {
            default: {
                header: defaultConfig.header,
                welcome: defaultConfig.welcome,
                suggestedQuestions: defaultConfig.suggestedQuestions
            },
            custom: {
                header: {
                    title: "Custom Demo Chat"
                },
                welcome: {
                    title: "Hello there!",
                    description: "This is a customized welcome message. You can adjust this to fit your needs."
                },
                suggestedQuestions: [
                    {
                        text: "Tell me a joke",
                        query: "Tell me a joke"
                    },
                    {
                        text: "Help with installation",
                        query: "How do I install this widget?"
                    },
                    {
                        text: "Documentation",
                        query: "Where can I find the documentation?"
                    }
                ]
            }
        };

        // Initialize the widget
        function initWidget() {
            if (!widgetInitialized) {
                const apiUrl = document.getElementById('api-url').value || 'http://localhost:3000';
                const apiKey = document.getElementById('api-key').value || 'demo-api-key';
                
                if (!apiKey) {
                    alert('API key is required. Using default demo key.');
                    document.getElementById('api-key').value = 'demo-api-key';
                }

                // Ensure the container exists
                const container = document.getElementById('chatbot-widget');
                if (!container) {
                    console.error('Chatbot container not found. Creating container...');
                    const newContainer = document.createElement('div');
                    newContainer.id = 'chatbot-widget';
                    document.body.appendChild(newContainer);
                }
                
                // Configure the API first
                if (window.ChatbotWidget) {
                    window.ChatbotWidget.setApiUrl(apiUrl);
                    window.ChatbotWidget.setApiKey(apiKey);
                }

                // Get current limits and validate suggestedQuestions before passing to widget
                const limits = getCustomLimits();
                const safeConfig = {
                    ...defaultConfig,
                    suggestedQuestions: validateSuggestedQuestions(
                        defaultConfig.suggestedQuestions,
                        limits.maxSuggestedQuestionLength,
                        limits.maxSuggestedQuestionQueryLength
                    )
                };
                
                window.initChatbotWidget({
                    apiUrl: apiUrl,
                    apiKey: apiKey,
                    widgetConfig: { ...safeConfig, ...limits }
                });
                
                widgetInitialized = true;
                
                // Setup event listeners for code updates
                document.getElementById('api-url').addEventListener('change', updateCodeExample);
                document.getElementById('api-key').addEventListener('change', updateCodeExample);
                
                // Initial code update
                setTimeout(updateCodeExample, 1000);
            }
        }

        // Initialize widget in custom container
        function initInCustomContainer() {
            if (!customWidgetInitialized) {
                const customContainer = document.getElementById('custom-container');
                if (!customContainer) {
                    console.error('Custom container not found. Creating container...');
                    const newContainer = document.createElement('div');
                    newContainer.id = 'custom-container';
                    document.body.appendChild(newContainer);
                }
                
                const apiUrl = document.getElementById('api-url').value || 'http://localhost:3000';
                const apiKey = document.getElementById('api-key').value || 'demo-api-key';
                
                if (!apiKey) {
                    alert('API key is required. Using default demo key.');
                    document.getElementById('api-key').value = 'demo-api-key';
                }
                
                // Configure the API first
                if (window.ChatbotWidget) {
                    window.ChatbotWidget.setApiUrl(apiUrl);
                    window.ChatbotWidget.setApiKey(apiKey);
                }

                // Get current limits and validate suggestedQuestions before passing to widget
                const limits = getCustomLimits();
                const safeConfig = {
                    ...defaultConfig,
                    suggestedQuestions: validateSuggestedQuestions(
                        defaultConfig.suggestedQuestions,
                        limits.maxSuggestedQuestionLength,
                        limits.maxSuggestedQuestionQueryLength
                    )
                };
                
                window.initChatbotWidget({
                    apiUrl: apiUrl,
                    apiKey: apiKey,
                    containerSelector: '#custom-container',
                    widgetConfig: { ...safeConfig, ...limits, header: { title: "Custom Container Chat" } }
                });
                
                customWidgetInitialized = true;
            }
        }

        // Update API URL
        function updateApiUrl() {
            const apiUrl = document.getElementById('api-url').value;
            const apiKey = document.getElementById('api-key').value;
            if (apiUrl && apiKey && window.ChatbotWidget) {
                window.ChatbotWidget.setApiUrl(apiUrl);
                window.ChatbotWidget.setApiKey(apiKey);
                alert(`API settings updated:\nURL: ${apiUrl}\nKey: ${apiKey}`);
            } else {
                alert('Please enter a valid API URL and Key (key cannot be empty)');
            }
        }

        // Update theme
        function updateTheme(themeName) {
            if (window.ChatbotWidget && themes[themeName]) {
                window.ChatbotWidget.updateWidgetConfig({
                    theme: themes[themeName]
                });
                
                // Update active class on theme cards
                document.querySelectorAll('.theme-card').forEach(card => {
                    card.classList.remove('active');
                });
                document.querySelector(`.theme-card[onclick="updateTheme('${themeName}')"]`).classList.add('active');
                
                // Update color picker values
                const theme = themes[themeName];
                document.getElementById('primary-color').value = theme.primary;
                document.getElementById('secondary-color').value = theme.secondary;
                document.getElementById('background-color').value = theme.background;
                document.getElementById('text-primary-color').value = theme.text.primary;
                document.getElementById('user-bubble-color').value = theme.message.user;
                document.getElementById('assistant-bubble-color').value = theme.message.assistant;
                document.getElementById('icon-color').value = theme.iconColor;

                document.getElementById('suggested-text-color').value = theme.suggestedQuestions.text;
                document.getElementById('chat-button-bg-color').value = theme.chatButton.background;
                document.getElementById('chat-button-hover-color').value = theme.chatButton.hoverBackground;
                
                // Update color previews
                updateColorPreviews();
                
                // Update implementation code
                updateCodeExample();
            }
        }
        
        // Apply custom colors from the color picker
        function applyCustomColors() {
            const customTheme = {
                primary: document.getElementById('primary-color').value,
                secondary: document.getElementById('secondary-color').value,
                background: document.getElementById('background-color').value,
                text: {
                    primary: document.getElementById('text-primary-color').value,
                    secondary: '#666666',
                    inverse: '#ffffff'
                },
                input: {
                    background: '#f9fafb',
                    border: '#e5e7eb'
                },
                message: {
                    user: document.getElementById('user-bubble-color').value,
                    assistant: document.getElementById('assistant-bubble-color').value,
                    userText: '#ffffff'
                },
                suggestedQuestions: {
                    background: 'transparent',
                    hoverBackground: 'transparent',
                    text: document.getElementById('suggested-text-color').value
                },
                chatButton: {
                    background: document.getElementById('chat-button-bg-color').value,
                    hoverBackground: document.getElementById('chat-button-hover-color').value
                },
                iconColor: document.getElementById('icon-color').value
            };
            
            if (window.ChatbotWidget) {
                window.ChatbotWidget.updateWidgetConfig({
                    theme: customTheme
                });
                
                // Remove active class from all theme cards
                document.querySelectorAll('.theme-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                // Update implementation code
                updateCodeExample();
            }
        }

        // Update content
        function updateContent(contentName) {
            if (window.ChatbotWidget && contents[contentName]) {
                // Track the current content type
                currentContentType = contentName;
                
                const limits = getCustomLimits();
                const updatedContent = {
                    ...contents[contentName],
                    suggestedQuestions: validateSuggestedQuestions(
                        contents[contentName].suggestedQuestions || [],
                        limits.maxSuggestedQuestionLength,
                        limits.maxSuggestedQuestionQueryLength
                    )
                };
                window.ChatbotWidget.updateWidgetConfig(updatedContent);
                
                // Reset previous limits tracking when content changes
                previousLimits = { ...limits };
                
                // Update implementation code
                updateCodeExample();
            }
        }

        // Update icon
        function updateIcon(iconName) {
            if (window.ChatbotWidget) {
                window.ChatbotWidget.updateWidgetConfig({
                    icon: iconName
                });
                
                // Highlight the active icon button
                document.querySelectorAll('.icon-btn').forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(iconName)) {
                        btn.style.backgroundColor = themes.modern.secondary;
                    } else {
                        btn.style.backgroundColor = '';
                    }
                });
                
                // Update implementation code
                updateCodeExample();
            }
        }

        // Toggle chat open/close
        function toggleChat() {
            if (window.ChatbotWidget && window.ChatbotWidget.toggleChat) {
                window.ChatbotWidget.toggleChat();
            } else {
                console.log('Chat toggle method not available');
            }
        }

        // Reset widget
        function resetWidget() {
            if (window.ChatbotWidget) {
                window.ChatbotWidget.updateWidgetConfig(defaultConfig);
                
                // Also update any API URL and key
                const apiUrl = document.getElementById('api-url').value;
                const apiKey = document.getElementById('api-key').value;
                if (apiUrl) {
                    window.ChatbotWidget.setApiUrl(apiUrl);
                }
                if (apiKey) {
                    window.ChatbotWidget.setApiKey(apiKey);
                }
            }
        }

        // Function to update the implementation code example
        function updateCodeExample() {
            if (!window.ChatbotWidget) return;
            
            try {
                const apiUrl = document.getElementById('api-url').value || 'http://localhost:3000';
                const apiKey = document.getElementById('api-key').value || '';
                
                // Fallback to default config if getCurrentConfig is not available
                const config = window.ChatbotWidget.getCurrentConfig?.() || defaultConfig;
                
                // Create display-friendly config
                const displayConfig = {
                    header: config.header,
                    welcome: config.welcome,
                    suggestedQuestions: config.suggestedQuestions,
                    theme: config.theme,
                    icon: config.icon
                };
                
                // Convert to pretty JSON with JS-friendly formatting
                let configStr = JSON.stringify(displayConfig, null, 4)
                    .replace(/"([^\"]+)":/g, '$1:')  // Remove quotes from property names
                    .replace(/"/g, "'");            // Use single quotes instead of double quotes
                
                // Build the code example with all dependencies bundled
                const codeExample = [
                    '<!-- Include the chatbot widget (all-in-one bundle) -->',
                    '<script src="/chatbot-widget.umd.js"><\/script>',
                    '<link rel="stylesheet" href="/style.css">',
                    '',
                    '<script>',
                    '  window.addEventListener("load", function() {',
                    '    window.initChatbotWidget({',
                    '      apiUrl: "' + apiUrl + '",',
                    '      apiKey: "' + apiKey + '",',
                    '      widgetConfig: ' + configStr,
                    '    });',
                    '  });',
                    '<\/script>'
                ].join('\n');
                
                // Update the code display
                document.getElementById('implementation-code').textContent = codeExample;
                if (window.Prism) Prism.highlightAll();
            } catch (error) {
                console.error('Error updating code example:', error);
            }
        }
        
        // Copy implementation code to clipboard
        function copyImplementationCode() {
            const codeElement = document.getElementById('implementation-code');
            navigator.clipboard.writeText(codeElement.textContent)
                .then(() => {
                    alert('Implementation code copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = codeElement.textContent;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('Implementation code copied to clipboard!');
                });
        }

        // Function to update color preview elements
        function updateColorPreviews() {
            // Get all color input elements
            const colorInputs = document.querySelectorAll('input[type="color"]');
            
            // For each color input, update its corresponding preview
            colorInputs.forEach(input => {
                // Find the next sibling div (the preview element)
                const previewEl = input.parentElement.querySelector('div:last-child');
                if (previewEl) {
                    previewEl.style.background = input.value;
                }
                
                // Add event listener to update the preview when color changes
                input.addEventListener('input', function() {
                    if (previewEl) {
                        previewEl.style.background = this.value;
                    }
                });
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add getCurrentConfig method to ChatbotWidget
            const initChatbotConfig = function() {
                if (window.ChatbotWidget && !window.ChatbotWidget.getCurrentConfig) {
                    window.ChatbotWidget._latestConfig = {...defaultConfig};
                    
                    window.ChatbotWidget.getCurrentConfig = function() {
                        return this._latestConfig || defaultConfig;
                    };

                    const originalUpdateMethod = window.ChatbotWidget.updateWidgetConfig;
                    window.ChatbotWidget.updateWidgetConfig = function(config) {
                        this._latestConfig = {...this._latestConfig, ...config};
                        originalUpdateMethod.call(this, config);
                        setTimeout(updateCodeExample, 100);
                    };
                }
            };

            // Try to initialize after the widget is loaded
            setTimeout(function() {
                setTimeout(updateColorPreviews, 500);
                initChatbotConfig();
            }, 1000);
        });

        // Add UUID generation function
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Validate and truncate suggested questions
        function validateSuggestedQuestions(questions, maxLength = 50, maxQueryLength = 200) {
            return questions.map(question => ({
                ...question,
                text: question.text && question.text.length > maxLength 
                    ? question.text.substring(0, maxLength - 3) + '...'
                    : question.text,
                query: question.query && question.query.length > maxQueryLength
                    ? question.query.substring(0, maxQueryLength)
                    : question.query
            }));
        }

        // --- Live Theme Customizer ---
        // Listen for color input changes for live preview
        document.addEventListener('DOMContentLoaded', function() {
            const colorInputs = document.querySelectorAll('.color-customizer input[type="color"]');
            colorInputs.forEach(input => {
                input.addEventListener('input', function() {
                    // Update the swatch
                    const previewEl = this.parentElement.querySelector('div:last-child');
                    if (previewEl) previewEl.style.background = this.value;
                    // Live update the widget
                    applyCustomColors();
                });
            });
        });

        // Reset to Default button functionality
        function resetThemeColors() {
            const theme = themes.modern;
            document.getElementById('primary-color').value = theme.primary;
            document.getElementById('secondary-color').value = theme.secondary;
            document.getElementById('background-color').value = theme.background;
            document.getElementById('text-primary-color').value = theme.text.primary;
            document.getElementById('user-bubble-color').value = theme.message.user;
            document.getElementById('assistant-bubble-color').value = theme.message.assistant;
            document.getElementById('icon-color').value = theme.iconColor;

            document.getElementById('suggested-text-color').value = theme.suggestedQuestions.text;
            document.getElementById('chat-button-bg-color').value = theme.chatButton.background;
            document.getElementById('chat-button-hover-color').value = theme.chatButton.hoverBackground;
            // Update color previews
            updateColorPreviews();
            // Live update the widget
            applyCustomColors();
        }

        // Add this function to handle custom limits
        function getCustomLimits() {
            return {
                maxSuggestedQuestionLength: Number(document.getElementById('max-suggested-question-length').value) || 50,
                maxSuggestedQuestionQueryLength: Number(document.getElementById('max-suggested-question-query-length').value) || 200
            };
        }
        // Track which content is currently active and previous limits
        let currentContentType = 'default';
        let previousLimits = {
            maxSuggestedQuestionLength: 50,
            maxSuggestedQuestionQueryLength: 200
        };
        
        function applyCustomLimits() {
            const newLimits = getCustomLimits();
            if (window.ChatbotWidget) {
                // Use the appropriate original source based on current content type
                const originalSuggestedQuestions = currentContentType === 'default' 
                    ? defaultConfig.suggestedQuestions 
                    : contents[currentContentType]?.suggestedQuestions || defaultConfig.suggestedQuestions;
                
                // Get current widget questions to selectively update only changed fields
                const currentConfig = window.ChatbotWidget.getCurrentConfig?.() || defaultConfig;
                const currentQuestions = currentConfig.suggestedQuestions || originalSuggestedQuestions;
                
                // Determine which limits changed
                const questionLengthChanged = newLimits.maxSuggestedQuestionLength !== previousLimits.maxSuggestedQuestionLength;
                const queryLengthChanged = newLimits.maxSuggestedQuestionQueryLength !== previousLimits.maxSuggestedQuestionQueryLength;
                
                // Process suggested questions selectively
                const updatedSuggestedQuestions = originalSuggestedQuestions.map((originalQuestion, index) => {
                    const currentQuestion = currentQuestions[index] || originalQuestion;
                    
                    return {
                        ...currentQuestion,
                        // Only update text if question length limit changed
                        text: questionLengthChanged
                            ? (originalQuestion.text && originalQuestion.text.length > newLimits.maxSuggestedQuestionLength
                                ? originalQuestion.text.substring(0, newLimits.maxSuggestedQuestionLength - 3) + '...'
                                : originalQuestion.text)
                            : currentQuestion.text,
                        // Only update query if query length limit changed  
                        query: queryLengthChanged
                            ? (originalQuestion.query && originalQuestion.query.length > newLimits.maxSuggestedQuestionQueryLength
                                ? originalQuestion.query.substring(0, newLimits.maxSuggestedQuestionQueryLength)
                                : originalQuestion.query)
                            : currentQuestion.query
                    };
                });
                
                // Update widget with both limits and selectively refreshed suggested questions
                window.ChatbotWidget.updateWidgetConfig({
                    ...newLimits,
                    suggestedQuestions: updatedSuggestedQuestions
                });
                
                console.log('Applied custom limits:', newLimits);
                console.log('Question length changed:', questionLengthChanged, 'Query length changed:', queryLengthChanged);
                console.log('Updated suggested questions:', updatedSuggestedQuestions);
                
                // Update previous limits for next comparison
                previousLimits = { ...newLimits };
            }
        }
    </script>
</body>
</html> 